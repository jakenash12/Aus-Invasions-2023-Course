knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(vegan)
library(car)
library(magrittr)
library(ecodist)
library(ANCOMBC)
library(phyloseq)
extract_text <- function(x) {
sub(".+__", "", x)
}
TaxMatITS=
read_tsv("../Aus23_ITS_Metabarcoding/ITS2_Dada2_repseqs97_taxonomy.tsv") %>%
rename("otu"="Feature ID") %>%
select(-Confidence) %>%
separate_wider_delim(too_few="align_start", cols = Taxon, delim = ";", names = c("Kingdom", "Phylum","Class", "Order","Family","Genus","Species", "SH")) %>%
mutate(across(!contains("otu"), ~extract_text(.)))
OtuMatITS=
read_tsv("../Aus23_ITS_Metabarcoding/ITS2_OTUTable_97.tsv", skip=1) %>%
column_to_rownames("#OTU ID")
Metadata_ITS=
read_tsv("../Aus23_16S_Metabarcoding/MetabarcodingMetadata.txt") %>%
slice(-1) %>%
rename("SampleID"=`sample-id`)
SeqDepthITS=
OtuMatITS %>%
colSums() %>%
as.data.frame %>%
set_colnames("n_sequences")
RareCurve_ITs=
OtuMatITS %>%
t %>%
rarecurve(step=500, tidy=TRUE)
ggplot(RareCurve_ITs, aes(x=Sample, y=Species, group=Site)) +
geom_line() +
geom_vline(xintercept=70218, linetype=2) +
ylab("# ASVs") +
xlab("# Sequences")
set.seed(2023)
OtuMatITS_rare=
OtuMatITS %>%
t %>%
as.data.frame %>%
rrarefy(sample=70218) %>%
as.data.frame %>%
select(-which(colSums(.) == 0)) %>%
filter(rowSums(.) >= 70218)
SuillOTUS=
TaxMatITS %>%
filter(Genus=="Suillus", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
View(Suillus_OTUs_Abundance)
SuillusAbundance_spread=
SuillusAbundance %>%
spread(TreeSpecies,Suillus)
View(SuillusAbundance_spread)
SuillusAbundance_spread=
SuillusAbundance %>%
select(SampleType, TreeID, TreeSpecies, Suillus) %>%
spread(TreeSpecies,Suillus)
SuillusAbundance_spread=
SuillusAbundance %>%
select(SampleType, TreeID, TreeSpecies, Suillus) %>% View
SuillusAbundance_spread=
SuillusAbundance %>%
select(SampleType, TreeID, TreeSpecies, Suillus) %>%
spread(key=TreeSpecies,stat=Suillus)
SuillusAbundance_spread=
SuillusAbundance %>%
select(SampleType, TreeID, TreeSpecies, Suillus) %>%
spread(key=TreeSpecies,value=Suillus)
SuillusAbundance_spread=
SuillusAbundance %>%
filter(SampleType=="Root") %>%
select(TreeID, TreeSpecies, Suillus) %>%
spread(key=TreeSpecies,value=Suillus)
SuillusAbundance_spread=
SuillusAbundance %>%
group_by(TreeSpecies, TreeID, SampleType) %>%
summarise(Suillus=mean(Suillus))
View(SuillusAbundance_spread)
SuillusAbundance_spread=
SuillusAbundance %>%
group_by(TreeSpecies, TreeID, SampleType) %>%
summarise(Suillus=mean(Suillus)) %>%
ungroup %>%
mutate(TypeSpecies=paste(TreeSpecies, SampleType, sep="_")) %>%
spread(key=TreeSpecies,value=Suillus)
SuillusAbundance_spread=
SuillusAbundance %>%
group_by(TreeSpecies, TreeID, SampleType) %>%
summarise(Suillus=mean(Suillus)) %>%
ungroup %>%
mutate(TypeSpecies=paste(TreeSpecies, SampleType, sep="_")) %>%
spread(key=TypeSpecies,value=Suillus)
SuillusAbundance_spread=
SuillusAbundance %>%
group_by(TreeSpecies, TreeID, SampleType) %>%
summarise(Suillus=mean(Suillus)) %>%
ungroup %>%
mutate(TypeSpecies=paste(TreeSpecies, SampleType, sep="_")) %>%View
SuillusAbundance_spread=
SuillusAbundance %>%
group_by(TreeSpecies, TreeID, SampleType) %>%
summarise(Suillus=mean(Suillus)) %>%
ungroup %>%
mutate(TypeSpecies=paste(TreeSpecies, SampleType, sep="_")) %>%
spread(key=TypeSpecies,value=Suillus)
SuillusAbundance_spread=
SuillusAbundance %>%
group_by(TreeSpecies, TreeID, SampleType) %>%
summarise(Suillus=mean(Suillus)) %>%
ungroup %>%
mutate(TypeSpecies=paste(TreeSpecies, SampleType, sep="_")) %>%
select(-SampleType, -TreeSpecies) %>%
spread(key=TypeSpecies,value=Suillus)
ggplot(SuillusAbundance_spread, aes(x=Eucalyptus_Root, y=Eucalyptus_Soil)) +
geom_point()
ggplot(SuillusAbundance_spread, aes(x=Eucalyptus_Root, y=Pine_Root)) +
geom_point()
ggplot(SuillusAbundance_spread, aes(x=Eucalyptus_Root, y=Eucalyptus_Soil)) +
geom_point()
ggplot(SuillusAbundance_spread, aes(x=Pine_Root, y=Eucalyptus_Soil)) +
geom_point()
ggplot(SuillusAbundance_spread, aes(x=Pine_Root, y=Pine_Soil)) +
geom_point()
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot() +
geom_point()
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies))
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_jitterdodge(width=0.75),aes(group=TreeSpecies))
geom_point(position=position_jitterdodge(,aes(group=TreeSpecies))
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_jitterdodge(),aes(group=TreeSpecies))
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies))
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
View(Suillus_OTUs_Abundance)
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS) %>%
gather(otu, Abundance, -TreeSpecies, -SampleType, -TreeID, -PlotRep)
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS) %>%
gather(otu, Abundance, -TreeSpecies, -SampleType, -TreeID, -Plot_Rep)
View(Suillus_OTUs_Abundance)
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies)) +
facet_wrap(.~otu)
ggplot(Suillus_OTUs_Abundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies)) +
facet_wrap(.~otu)
ggplot(Suillus_OTUs_Abundance, aes(x=SampleType, y=log(Abundance+1), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies)) +
facet_wrap(.~otu)
ggplot(Suillus_OTUs_Abundance, aes(x=SampleType, y=log(Abundance+1), color=TreeSpecies)) +
geom_boxplot()
ggplot(Suillus_OTUs_Abundance, aes(x=SampleType, y=Abundance, color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies)) +
facet_wrap(.~otu)
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS) %>%
gather(otu, Abundance, -TreeSpecies, -SampleType, -TreeID, -Plot_Rep) %>%
mutate(Abundance=as.numeric(Abundance))
ggplot(Suillus_OTUs_Abundance, aes(x=SampleType, y=log(Abundance+0.01), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies)) +
facet_wrap(.~otu)
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS) %>%
gather(otu, Abundance, -TreeSpecies, -SampleType, -TreeID, -Plot_Rep, -SampleID) %>%
mutate(Abundance=as.numeric(Abundance))
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS) %>%
gather(otu, Abundance, -TreeSpecies, -SampleType, -TreeID, -Plot_Rep, -SampleID) %>%
mutate(Abundance=as.numeric(Abundance))
ggplot(Suillus_OTUs_Abundance, aes(x=SampleType, y=log(Abundance+0.01), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies)) +
facet_wrap(.~otu)
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS) %>%
gather(otu, Abundance, -TreeSpecies, -SampleType, -TreeID, -Plot_Rep, -SampleID, -TreeSpecies_SampleType) %>%
mutate(Abundance=as.numeric(Abundance))
ggplot(Suillus_OTUs_Abundance, aes(x=SampleType, y=log(Abundance+0.01), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies)) +
facet_wrap(.~otu)
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS) %>%
gather(otu, Abundance, -TreeSpecies, -SampleType, -TreeID, -Plot_Rep, -SampleID, -TreeSpecies_SampleType)
ggplot(Suillus_OTUs_Abundance, aes(x=SampleType, y=log(Abundance+0.01), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies)) +
facet_wrap(.~otu)
library(readxl)
UpdatedTax=read_excel("../Aus23_ITS_Metabarcoding/ITS2_Dada2_repseqs97_taxonomy_edited.xlsx")
View(UpdatedTax)
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS) %>%
gather(otu, Abundance, -TreeSpecies, -SampleType, -TreeID, -Plot_Rep, -SampleID, -TreeSpecies_SampleType) %>%
left_join(UpdatedTax)
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS) %>%
gather(otu, Abundance, -TreeSpecies, -SampleType, -TreeID, -Plot_Rep, -SampleID, -TreeSpecies_SampleType) %>%
left_join(UpdatedTax,by="Feature ID"="otu")
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS) %>%
gather(otu, Abundance, -TreeSpecies, -SampleType, -TreeID, -Plot_Rep, -SampleID, -TreeSpecies_SampleType) %>%
left_join(UpdatedTax,by.x="Feature ID", by.y="otu")
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS) %>%
gather(otu, Abundance, -TreeSpecies, -SampleType, -TreeID, -Plot_Rep, -SampleID, -TreeSpecies_SampleType) %>%
left_join(UpdatedTax,by=c("Feature ID"="otu"))
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS) %>%
gather(otu, Abundance, -TreeSpecies, -SampleType, -TreeID, -Plot_Rep, -SampleID, -TreeSpecies_SampleType) %>%
left_join(UpdatedTax,by=c("otu"="Feature ID"))
ggplot(Suillus_OTUs_Abundance, aes(x=SampleType, y=log(Abundance+0.01), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies)) +
facet_wrap(.~Species)
Suillus_OTUs_Abundance$Species %>% unique
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS) %>%
gather(otu, Abundance, -TreeSpecies, -SampleType, -TreeID, -Plot_Rep, -SampleID, -TreeSpecies_SampleType) %>%
left_join(UpdatedTax,by=c("otu"="Feature ID")) %>%
mutate(SpeciesOTU=paste(Species, otu, sep="_"))
ggplot(Suillus_OTUs_Abundance, aes(x=SampleType, y=log(Abundance+0.01), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies)) +
facet_wrap(.~SpeciesOTU)
ggplot(Suillus_OTUs_Abundance, aes(x=SampleType, y=log(Abundance+0.01), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies)) +
facet_wrap(.~SpeciesOTU) +
theme(strip.text.y = element_text(angle = 0, hjust = 0))
ggplot(Suillus_OTUs_Abundance, aes(x=SampleType, y=log(Abundance+0.01), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies)) +
facet_wrap(.~SpeciesOTU) +
theme(strip.text.x = element_text(angle = 0, hjust = 0))
UpdatedTax=read_excel("../Aus23_ITS_Metabarcoding/ITS2_Dada2_repseqs97_taxonomy_edited.xlsx")
UpdatedTax=read_excel("../Aus23_ITS_Metabarcoding/ITS2_Dada2_repseqs97_taxonomy_edited.xlsx")
Suillus_OTUs_Abundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS) %>%
gather(otu, Abundance, -TreeSpecies, -SampleType, -TreeID, -Plot_Rep, -SampleID, -TreeSpecies_SampleType) %>%
left_join(UpdatedTax,by=c("otu"="Feature ID")) %>%
mutate(SpeciesOTU=paste(Species, otu, sep="_"))
ggplot(Suillus_OTUs_Abundance, aes(x=SampleType, y=log(Abundance+0.01), color=TreeSpecies)) +
geom_boxplot() +
geom_point(position=position_dodge(width=0.75),aes(group=TreeSpecies)) +
facet_wrap(.~SpeciesOTU) +
theme(strip.text.x = element_text(angle = 0, hjust = 0))
library(dplyr)
library(tidyr)
eco <- read.csv("Merged_data/eco_plates_wide_averaged.csv")
cn <- read.csv("Merged_data/Aus23_microbes_soilCNP_pooled.csv")
library(dplyr)
library(tidyr)
eco <- read.csv("Merged_data/eco_plates_wide_averaged.csv")
cn <- read.csv("Merged_data/Aus23_microbes_soilCNP_pooled.csv")
cn$treeName
eco <- eco %>%
mutate(treeName = case_when(
tree_spp == "euc" ~ paste0("E", tree_num),
tree_spp == "pine" ~ paste0("P", tree_num),
TRUE ~ NA_character_  # Handles other cases if needed
))
ds <- full_join(eco, cn)
write.csv(ds, "Merged_data/Aus23_CNP_pooled_biolog.csv")
