filter(Genus=="Thelephora", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
SuillOTUS=
TaxMatITS %>%
filter(Genus=="Hyaloscypha", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
SuillOTUS=
TaxMatITS %>%
filter(Order=="Helotiales", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
ANCOM_ITS_SampleType = ancombc(data = PhyloseqITS, assay_name = "counts",
tax_level = "Species", phyloseq = NULL,
formula = "SampleType + TreeSpecies",
group="SampleType", p_adj_method = "holm", prv_cut = 0.10, lib_cut = 1000,
struc_zero = TRUE, neg_lb = TRUE, tol = 1e-5,
max_iter = 100, conserve = TRUE, alpha = 0.05, global = TRUE,
n_cl = 1, verbose = TRUE)
ANCOM_ITS_SampleType$res$lfc %>% View
PhyloseqITS_root=subset_samples(PhyloseqITS, SampleType=="Root")
PhyloseqITS_root=subset_samples(PhyloseqITS, SampleType=="Root")
ANCOM_ITS_root = ancombc(data = PhyloseqITS_root, assay_name = "counts",
tax_level = "Species", phyloseq = NULL,
formula = "TreeSpecies",
group="SampleType", p_adj_method = "holm", prv_cut = 0.10, lib_cut = 1000,
struc_zero = TRUE, neg_lb = TRUE, tol = 1e-5,
max_iter = 100, conserve = TRUE, alpha = 0.05, global = TRUE,
n_cl = 1, verbose = TRUE)
PhyloseqITS_root %>% otu_table()
ANCOM_ITS_root = ancombc(data = PhyloseqITS_root, assay_name = "counts",
tax_level = "Species", phyloseq = NULL,
formula = "TreeSpecies",
group="TreeSpecies", p_adj_method = "holm", prv_cut = 0.10, lib_cut = 1000,
struc_zero = TRUE, neg_lb = TRUE, tol = 1e-5,
max_iter = 100, conserve = TRUE, alpha = 0.05, global = TRUE,
n_cl = 1, verbose = TRUE)
ANCOM_ITS_root$res$lfc
ANCOM_ITS_root$res$lfc %>% View
ANCOM_ITS_root$res$p_val %>% View
ANCOM_ITS_root$res$p_val$TreeSpeciesPine<0.05 %$% taxon
ANCOM_ITS_root_sig= ANCOM_ITS_root$res$p_val %>% filter(TreeSpeciesPine<0.05) $%$ taxon
ANCOM_ITS_root_sig= ANCOM_ITS_root$res$p_val %>% as.data.frame %>% filter(TreeSpeciesPine<0.05) $%$ taxon
ANCOM_ITS_root_sig=
ANCOM_ITS_root$res$p_val %>%
as.data.frame
ANCOM_ITS_root_sig=
ANCOM_ITS_root$res$p_val %>%
as.data.frame %>% filter(TreeSpeciesPine<0.05)
ANCOM_ITS_root_sig=
ANCOM_ITS_root$res$p_val %>%
as.data.frame %>% filter(TreeSpeciesPine<0.05) %$%
taxon
ANCOM_ITS_root_sig
ANCOM_ITS_root$res$lfc %>% as.data.frame %>% filter(taxon %in% ANCOM_ITS_root_sig) %>% View
ANCOM_ITS_root$res$lfc %>% View
OTU_ITS_phyloseq=
OtuMatITS_rare %>%
as.matrix %>%
otu_table(taxa_are_rows = FALSE)
TAX_ITS_phyloseq=
TaxMatITS %>%
filter(otu %in% colnames(OtuMatITS_rare)) %>%
column_to_rownames("otu") %>%
as.matrix %>%
tax_table
SAMPLES_ITS_phyloseq=
Metadata_ITS %>%
filter(SampleID %in% rownames(OTU_ITS_phyloseq)) %>%
column_to_rownames("SampleID") %>%
sample_data(Metadata_16S)
PhyloseqITS <- phyloseq(OTU_ITS_phyloseq, TAX_ITS_phyloseq, SAMPLES_ITS_phyloseq)
PhyloseqITS_root=subset_samples(PhyloseqITS, SampleType=="Root")
ANCOM_ITS_root = ancombc(data = PhyloseqITS_root, assay_name = "counts",
tax_level = "Species", phyloseq = NULL,
formula = "TreeSpecies",
group="TreeSpecies", p_adj_method = "holm", prv_cut = 0.10, lib_cut = 1000,
struc_zero = TRUE, neg_lb = TRUE, tol = 1e-5,
max_iter = 100, conserve = TRUE, alpha = 0.05, global = TRUE,
n_cl = 1, verbose = TRUE)
ANCOM_ITS_root_sig=
ANCOM_ITS_root$res$p_val %>%
as.data.frame %>%
filter(TreeSpeciesPine<0.05) %$%
taxon
ANCOM_ITS_root$res$lfc %>% as.data.frame %>% filter(taxon %in% ANCOM_ITS_root_sig) %>% View
ANCOM_ITS_root$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_root_sig) %>%
mutate(Enrichment=ifelse(TreeeSpeciesPine<0, "Eucalyptus_enriched", "Pine_enriched")) %>%
View
ANCOM_ITS_root$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_root_sig) %>%
mutate(Enrichment=ifelse(TreeSpeciesPine<0, "Eucalyptus_enriched", "Pine_enriched")) %>%
View
PhyloseqITS_soil=subset_samples(PhyloseqITS, SampleType=="Soil")
ANCOM_ITS_soil = ancombc(data = PhyloseqITS_soil, assay_name = "counts",
tax_level = "Species", phyloseq = NULL,
formula = "TreeSpecies",
group="TreeSpecies", p_adj_method = "holm", prv_cut = 0.10, lib_cut = 1000,
struc_zero = TRUE, neg_lb = TRUE, tol = 1e-5,
max_iter = 100, conserve = TRUE, alpha = 0.05, global = TRUE,
n_cl = 1, verbose = TRUE)
ANCOM_ITS_soil_sig=
ANCOM_ITS_soil$res$p_val %>%
as.data.frame %>%
filter(TreeSpeciesPine<0.05) %$%
taxon
ANCOM_ITS_soil$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_soil_sig) %>%
mutate(Enrichment=ifelse(TreeSpeciesPine<0, "Eucalyptus_enriched", "Pine_enriched")) %>%
View
ANCOM_ITS_soil_results=
ANCOM_ITS_soil$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_soil_sig) %>%
mutate(Enrichment=ifelse(TreeSpeciesPine<0, "Eucalyptus_enriched", "Pine_enriched"))
ANCOM_ITS_root_results=
ANCOM_ITS_root$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_root_sig) %>%
mutate(Enrichment=ifelse(TreeSpeciesPine<0, "Eucalyptus_enriched", "Pine_enriched")) %>%
View
ANCOM_ITS_root_results=
ANCOM_ITS_root$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_root_sig) %>%
mutate(Enrichment=ifelse(TreeSpeciesPine<0, "Eucalyptus_enriched", "Pine_enriched"))
View(ANCOM_ITS_root_results)
View(ANCOM_ITS_soil_results)
SuillOTUS=
TaxMatITS %>%
filter(Phylum=="Glomeromycota", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
SuillOTUS=
TaxMatITS %>%
filter(Genus=="Xenopolyscytalum", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
SuillOTUS=
TaxMatITS %>%
filter(Genus=="Penicillium", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
SuillOTUS=
TaxMatITS %>%
filter(Genus=="Genus:Talaromyces", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
SuillOTUS=
TaxMatITS %>%
filter(Genus=="Talaromyces", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
SuillOTUS=
TaxMatITS %>%
filter(Genus=="Oidiodendron", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
SuillOTUS=
TaxMatITS %>%
filter(Genus=="Phialocephala", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
knitr::opts_chunk$set(echo = TRUE)
print(ANCOM_ITS_root_results)
p_thresh=0.05
View(ANCOM_ITS_soil_sig)
View(ANCOM_ITS_root_results)
ANCOM_ITS_root_results %>%
arrange(TreeSpeciesPine) %>%
slice(c(1:20, (n() - 19):n())) %>% View
library(tidyverse)
library(vegan)
library(car)
library(magrittr)
library(ecodist)
library(ANCOMBC)
library(phyloseq)
extract_text <- function(x) {
sub(".+__", "", x)
}
TaxMatITS=
read_tsv("../Aus23_ITS_Metabarcoding/ITS2_Dada2_repseqs97_taxonomy.tsv") %>%
rename("otu"="Feature ID") %>%
select(-Confidence) %>%
separate_wider_delim(too_few="align_start", cols = Taxon, delim = ";", names = c("Kingdom", "Phylum","Class", "Order","Family","Genus","Species", "SH")) %>%
mutate(across(!contains("otu"), ~extract_text(.)))
OtuMatITS=
read_tsv("../Aus23_ITS_Metabarcoding/ITS2_OTUTable_97.tsv", skip=1) %>%
column_to_rownames("#OTU ID")
Metadata_ITS=
read_tsv("../Aus23_16S_Metabarcoding/MetabarcodingMetadata.txt") %>%
slice(-1) %>%
rename("SampleID"=`sample-id`)
SeqDepthITS=
OtuMatITS %>%
colSums() %>%
as.data.frame %>%
set_colnames("n_sequences")
RareCurve_ITs=
OtuMatITS %>%
t %>%
rarecurve(step=500, tidy=TRUE)
ggplot(RareCurve_ITs, aes(x=Sample, y=Species, group=Site)) +
geom_line() +
geom_vline(xintercept=70218, linetype=2) +
ylab("# ASVs") +
xlab("# Sequences")
set.seed(2023)
OtuMatITS_rare=
OtuMatITS %>%
t %>%
as.data.frame %>%
rrarefy(sample=70218) %>%
as.data.frame %>%
select(-which(colSums(.) == 0)) %>%
filter(rowSums(.) >= 70218)
ANCOM_ITS_root_results %>%
arrange(TreeSpeciesPine) %>%
slice(c(1:20, (n() - 19):n())) %>%  View
ANCOM_ITS_root_results=
ANCOM_ITS_root$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_root_sig) %>%
rename(TreeSpeciesPine="LFC")
ANCOM_ITS_root_results=
ANCOM_ITS_root$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_root_sig) %>%
rename("LFC"="TreeSpeciesPine")
ANCOM_ITS_root_results=
ANCOM_ITS_root$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_root_sig) %>%
rename("LFC"="TreeSpeciesPine") %>%
mutate(Enrichment=ifelse(LFC<0, "Eucalyptus_enriched", "Pine_enriched"))
View(ANCOM_ITS_root_results)
ANCOM_ITS_root_results %>%
arrange(TreeSpeciesPine) %>%
slice(c(1:20, (n() - 19):n())) %>%
ggplot(aes(x=taxon, y=LFC)) +
geom_bar()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
ggplot(aes(x=taxon, y=LFC)) +
geom_bar()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
ggplot(aes(x=taxon, y=LFC)) +
geom_bar(stat="identity")
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
ggplot(aes(x=taxon, y=LFC)) +
geom_bar(stat="identity") +
coord_flip()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
ggplot(aes(x=taxon, y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=taxon, y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=taxon, y=reorder(taxon, -LFC), fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, -LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_test
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_test()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_classic()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal()
ANCOM_ITS_soil_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Soils - Eucalyptus vs. Pine")
ANCOM_ITS_soil_results=
ANCOM_ITS_soil$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_soil_sig) %>%
rename("LFC"="TreeSpeciesPine") %>%
mutate(Enrichment=ifelse(LFC<0, "Eucalyptus_enriched", "Pine_enriched"))
ANCOM_ITS_soil_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Soils - Eucalyptus vs. Pine")
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Plant Roots - Eucalyptus vs. Pine")
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Plant Roots - Eucalyptus vs. Pine - Top 40 enriched taxa")
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Plant Roots - Eucalyptus vs. Pine - Top 40 enriched taxa") +
geom_vline(xintercept=0)
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Plant Roots - Eucalyptus vs. Pine - Top 40 enriched taxa") +
geom_hline(yintercept=0)
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Plant Roots - Eucalyptus vs. Pine - Top 40 enriched taxa") +
geom_hline(yintercept=0, size=1)
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Plant Roots - Eucalyptus vs. Pine - Top 40 enriched taxa") +
geom_hline(yintercept=0)
ANCOM_ITS_soil_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Soils - Eucalyptus vs. Pine - Top 40 enriched taxa") +
geom_hline(yintercept=0)
ANCOM_ITS_soil_results %>%
arrange(LFC) %>%
slice(c(1:30, (n() - 39):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Soils - Eucalyptus vs. Pine - Top 40 enriched taxa") +
geom_hline(yintercept=0)
ANCOM_ITS_soil_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Soils - Eucalyptus vs. Pine - Top 40 enriched taxa") +
geom_hline(yintercept=0)
