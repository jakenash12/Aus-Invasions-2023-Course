"NoRandomEffect","NoRandomEffect","NoRandomEffect","NoRandomEffect"),
n_taxa_significant=c(n_ITS_root, n_ITS_soil, n_16S_root, n_16S_soil,
n_ITS_root_no_random, n_ITS_soil_no_random, n_16S_root_no_random, n_16S_soil_no_random))
knitr::opts_chunk$set(echo = TRUE)
library(MicrobiomeStat)
library(dplyr)
library(magrittr)
library(tibble)
library(ANCOMBC)
library(tidyverse)
library(readxl)
OTU_ITS_phyloseq=
OtuMatITS %>%
as.matrix %>%
otu_table(taxa_are_rows = FALSE)
TAX_ITS_phyloseq=
TaxMatITS %>%
filter(otu %in% colnames(OtuMatITS)) %>%
column_to_rownames("otu") %>%
as.matrix %>%
tax_table
colnames(TaxMatITS)
colnames(OtuMatITS)
nrow(OtuMatITS)
nrow(TaxMatITS)
TAX_ITS_phyloseq=
TaxMatITS %>%
filter(otu %in% colnames(OtuMatITS)) %>%
column_to_rownames("otu") %>%
as.matrix %>%
tax_table
TAX_ITS_phyloseq=
TaxMatITS %>%
filter(otu %in% colnames(OtuMatITS)) %>%
column_to_rownames("otu")
TAX_ITS_phyloseq=
TaxMatITS %>%
filter(otu %in% colnames(OtuMatITS)) %>%
column_to_rownames("otu") %>%
as.matrix
TAX_ITS_phyloseq=
TaxMatITS %>%
filter(otu %in% colnames(OtuMatITS)) %>%
column_to_rownames("otu") %>%
as.matrix %>%
tax_table
TAX_ITS_phyloseq=
TaxMatITS %>%
filter(otu %in% colnames(OtuMatITS)) %>%
column_to_rownames("otu") %>%
as.matrix
View(TAX_ITS_phyloseq)
TAX_ITS_phyloseq=
TaxMatITS %>%
filter(otu %in% rownames(OtuMatITS)) %>%
column_to_rownames("otu") %>%
as.matrix %>%
tax_table
rownames(OTU_ITS_phyloseq)
SAMPLES_ITS_phyloseq=
Metadata_ITS %>%
filter(SampleID %in% colnames(OTU_ITS_phyloseq)) %>%
column_to_rownames("SampleID") %>%
sample_data()
SAMPLES_ITS_phyloseq=
Metadata_ITS %>%
filter(SampleID %in% colnames(OTU_ITS_phyloseq)) %>%
column_to_rownames("SampleID") %>% View
PhyloseqITS <- phyloseq(OTU_ITS_phyloseq, TAX_ITS_phyloseq, SAMPLES_ITS_phyloseq)
ncol(OtuMatITS)
OTU_ITS_phyloseq=
OtuMatITS %>%
t %>%
as.matrix %>%
otu_table(taxa_are_rows = FALSE)
TAX_ITS_phyloseq=
TaxMatITS %>%
filter(otu %in% colnames(OtuMatITS)) %>%
column_to_rownames("otu") %>%
as.matrix %>%
tax_table
PhyloseqITS <- phyloseq(OTU_ITS_phyloseq, TAX_ITS_phyloseq, SAMPLES_ITS_phyloseq)
TAX_ITS_phyloseq=
TaxMatITS %>%
filter(otu %in% colnames(OtuMatITS)) %>%
column_to_rownames("otu") %>%
as.matrix %>%
tax_table
OTU_ITS_phyloseq=
OtuMatITS %>%
t %>%
as.matrix %>%
otu_table(taxa_are_rows = FALSE)
colnames(OtuMatITS)
OTU_ITS_phyloseq=
OtuMatITS %>%
t %>%
as.matrix %>%
otu_table(taxa_are_rows = FALSE)
colnames(OtuMatITS)
nrow(OtuMatITS)
OTU_ITS_phyloseq=
OtuMatITS %>%
as.matrix %>%
otu_table(taxa_are_rows = TRUE)
TAX_ITS_phyloseq=
TaxMatITS %>%
filter(otu %in% rownames(OtuMatITS)) %>%
column_to_rownames("otu") %>%
as.matrix %>%
tax_table
SAMPLES_ITS_phyloseq=
Metadata_ITS %>%
filter(SampleID %in% colnames(OTU_ITS_phyloseq)) %>%
column_to_rownames("SampleID") %>%
sample_data()
PhyloseqITS <- phyloseq(OTU_ITS_phyloseq, TAX_ITS_phyloseq, SAMPLES_ITS_phyloseq)
PhyloseqITS_root=subset_samples(PhyloseqITS, SampleType=="Root")
ANCOM_ITS_root = ancombc2(data = PhyloseqITS_root, assay_name = "counts",
tax_level = "Species", phyloseq = NULL,
formula = "TreeSpecies",
group="TreeSpecies", p_adj_method = "holm", prv_cut = 0.10, lib_cut = 1000,
struc_zero = TRUE, neg_lb = TRUE, tol = 1e-5,
max_iter = 100, conserve = TRUE, alpha = 0.05, global = TRUE,
n_cl = 1, verbose = TRUE)
ANCOM_ITS_root = ancombc2(data = PhyloseqITS_root, tax_level = NULL,
fix_formula = "TreeSpecies", rand_formula = NULL,
p_adj_method = "holm", pseudo_sens = TRUE,
prv_cut = 0.10, lib_cut = 1000, s0_perc = 0.05,
group = "cat_cov", struc_zero = FALSE, neg_lb = FALSE,
alpha = 0.05, n_cl = 2, verbose = TRUE,
global = FALSE, pairwise = TRUE,
dunnet = FALSE, trend = FALSE,
iter_control = list(tol = 1e-5, max_iter = 20,
verbose = FALSE),
em_control = list(tol = 1e-5, max_iter = 100),
lme_control = NULL,
mdfdr_control = list(fwer_ctrl_method = "holm", B = 100),
trend_control = NULL)
ANCOM_ITS_root = ancombc2(data = PhyloseqITS_root, tax_level = NULL,
fix_formula = "TreeSpecies", rand_formula = NULL,
p_adj_method = "holm", pseudo_sens = TRUE,
prv_cut = 0.10, lib_cut = 1000, s0_perc = 0.05,
group = "cat_cov", struc_zero = FALSE, neg_lb = FALSE,
alpha = 0.05, n_cl = 2, verbose = TRUE,
global = TRUE, pairwise = FALSE,
dunnet = FALSE, trend = FALSE,
iter_control = list(tol = 1e-5, max_iter = 20,
verbose = FALSE),
em_control = list(tol = 1e-5, max_iter = 100),
lme_control = NULL,
mdfdr_control = list(fwer_ctrl_method = "holm", B = 100),
trend_control = NULL)
TAX_ITS_phyloseq=
TaxMatITS %>%
filter(otu %in% rownames(OtuMatITS)) %>%
column_to_rownames("otu") %>%
as.matrix %>% View
ANCOM_ITS_root = ancombc2(data = PhyloseqITS_root, tax_level = "Species",
fix_formula = "TreeSpecies", rand_formula = NULL,
p_adj_method = "holm", pseudo_sens = TRUE,
prv_cut = 0.10, lib_cut = 1000, s0_perc = 0.05,
group = "cat_cov", struc_zero = FALSE, neg_lb = FALSE,
alpha = 0.05, n_cl = 2, verbose = TRUE,
global = TRUE, pairwise = FALSE,
dunnet = FALSE, trend = FALSE,
iter_control = list(tol = 1e-5, max_iter = 20,
verbose = FALSE),
em_control = list(tol = 1e-5, max_iter = 100),
lme_control = NULL,
mdfdr_control = list(fwer_ctrl_method = "holm", B = 100),
trend_control = NULL)
ANCOM_ITS_root = ancombc2(data = PhyloseqITS_root, tax_level = NULL,
fix_formula = "TreeSpecies", rand_formula = NULL,
p_adj_method = "holm", pseudo_sens = TRUE,
prv_cut = 0.10, lib_cut = 1000, s0_perc = 0.05,
group = "TreeSpecies", struc_zero = FALSE, neg_lb = FALSE,
alpha = 0.05, n_cl = 2, verbose = TRUE,
global = TRUE, pairwise = FALSE,
dunnet = FALSE, trend = FALSE,
iter_control = list(tol = 1e-5, max_iter = 20,
verbose = FALSE),
em_control = list(tol = 1e-5, max_iter = 100),
lme_control = NULL,
mdfdr_control = list(fwer_ctrl_method = "holm", B = 100),
trend_control = NULL)
ANCOM_ITS_root$res %>% View
ANCOM_ITS_root$res %>%
as.data.frame %>%
filter(diff_TreeSpeciesPine) %>%
nrow
ANCOM_ITS_root$res %>%
as.data.frame %>%
filter(diff_TreeSpeciesPine) %>%
View
ANCOM_ITS_root$res %>%
as.data.frame %>%
filter(diff_TreeSpeciesPine) %>%
rename("Taxon"="otu")
ANCOM_ITS_root$res %>%
as.data.frame %>%
filter(diff_TreeSpeciesPine) %>%
rename("otu"="Taxon")
ANCOM_ITS_root$res %>%
as.data.frame %>%
filter(diff_TreeSpeciesPine) %>%
rename("otu"="taxon")
ANCOM_ITS_root_df=
ANCOM_ITS_root$res %>%
as.data.frame %>%
filter(diff_TreeSpeciesPine) %>%
rename("otu"="taxon") %>%
left_join(TaxMatITS)
View(ANCOM_ITS_root_df)
#runs LinDA test for effect of tree species, using tree individual as random effects
Linda_ITS_root =
linda(
feature.dat=OtuMatITS_root,
meta.dat=Metadata_ITS_root,
formula='~TreeSpecies + (1|TreeSampleType)',
feature.dat.type="count",
prev.filter=0.1,
zero.handling="pseudo.cnt",
pseudo.cnt = 0.5,
p.adj.method="holm",
alpha=0.05)
Linda_ITS_root_no_random =
linda(
feature.dat=OtuMatITS_root,
meta.dat=Metadata_ITS_root,
formula='~TreeSpecies',
feature.dat.type="count",
prev.filter=0.1,
zero.handling="pseudo.cnt",
pseudo.cnt = 0.5,
p.adj.method="holm",
alpha=0.05)
#creates a formatted dataframe for ITS root samples LinDA
Linda_ITS_root_df=
as.data.frame(Linda_ITS_root$output$TreeSpeciesPine) %>%
mutate(otu=rownames(.)) %>%
left_join(TaxMatITS)
#creates a formatted dataframe for ITS root samples LinDA
Linda_ITS_root_df=
as.data.frame(Linda_ITS_root$output$TreeSpeciesPine) %>%
mutate(otu=rownames(.)) %>%
left_join(TaxMatITS)
Linda_ITS_root_no_random_df=
as.data.frame(Linda_ITS_root_no_random$output$TreeSpeciesPine) %>%
mutate(otu=rownames(.)) %>%
left_join(TaxMatITS)
#create ITS OTU table just with Root samples
OtuMatITS_root=
OtuMatITS%>%
select(contains("Root"))
#create metadata table just with root samples in ITS otu table
Metadata_ITS_root=
Metadata_ITS %>%
filter(SampleID %in% colnames(OtuMatITS_root))
#runs LinDA test for effect of tree species, using tree individual as random effects
Linda_ITS_root =
linda(
feature.dat=OtuMatITS_root,
meta.dat=Metadata_ITS_root,
formula='~TreeSpecies + (1|TreeSampleType)',
feature.dat.type="count",
prev.filter=0.1,
zero.handling="pseudo.cnt",
pseudo.cnt = 0.5,
p.adj.method="holm",
alpha=0.05)
Linda_ITS_root_no_random =
linda(
feature.dat=OtuMatITS_root,
meta.dat=Metadata_ITS_root,
formula='~TreeSpecies',
feature.dat.type="count",
prev.filter=0.1,
zero.handling="pseudo.cnt",
pseudo.cnt = 0.5,
p.adj.method="holm",
alpha=0.05)
#creates a formatted dataframe for ITS root samples LinDA
Linda_ITS_root_df=
as.data.frame(Linda_ITS_root$output$TreeSpeciesPine) %>%
mutate(otu=rownames(.)) %>%
left_join(TaxMatITS)
Linda_ITS_root_no_random_df=
as.data.frame(Linda_ITS_root_no_random$output$TreeSpeciesPine) %>%
mutate(otu=rownames(.)) %>%
left_join(TaxMatITS)
#create ITS OTU table just with Soil samples
OtuMatITS_soil=
OtuMatITS %>%
select(contains("Soil"))
#create metadata table just with root samples in ITS otu table
Metadata_ITS_soil=
Metadata_ITS %>%
filter(SampleID %in% colnames(OtuMatITS_soil))
#runs LinDA test for effect of tree species, using tree individual as random effects
Linda_ITS_soil =
linda(
feature.dat=OtuMatITS_soil,
meta.dat=Metadata_ITS_soil,
formula='~TreeSpecies + (1|TreeSampleType)',
feature.dat.type="count",
prev.filter=0.1,
zero.handling="pseudo.cnt",
pseudo.cnt = 0.5,
p.adj.method="holm",
alpha=0.05)
Linda_ITS_soil_no_random =
linda(
feature.dat=OtuMatITS_soil,
meta.dat=Metadata_ITS_soil,
formula='~TreeSpecies',
feature.dat.type="count",
prev.filter=0.1,
zero.handling="pseudo.cnt",
pseudo.cnt = 0.5,
p.adj.method="holm",
alpha=0.05)
#creates a formatted dataframe for ITS root samples LinDA
Linda_ITS_soil_df=
as.data.frame(Linda_ITS_soil$output$TreeSpeciesPine) %>%
mutate(otu=rownames(.)) %>%
left_join(TaxMatITS)
Linda_ITS_soil_no_random_df=
as.data.frame(Linda_ITS_soil_no_random$output$TreeSpeciesPine) %>%
mutate(otu=rownames(.)) %>%
left_join(TaxMatITS)
#create 16S OTU table just with Root samples
OtuMat16S_root=
OtuMat16S_filter %>%
select(contains("Root"))
#create metadata table just with root samples in 16S otu table
Metadata_16S_root=
Metadata_16S %>%
filter(SampleID %in% colnames(OtuMat16S_root))
#runs LinDA test for effect of tree species, using tree individual as random effects
Linda_16S_root =
linda(
feature.dat=OtuMat16S_root,
meta.dat=Metadata_16S_root,
formula='~TreeSpecies + (1|TreeSampleType)',
feature.dat.type="count",
prev.filter=0.1,
zero.handling="pseudo.cnt",
pseudo.cnt = 0.5,
p.adj.method="holm",
alpha=0.05)
Linda_16S_root_no_random =
linda(
feature.dat=OtuMat16S_root,
meta.dat=Metadata_16S_root,
formula='~TreeSpecies',
feature.dat.type="count",
prev.filter=0.1,
zero.handling="pseudo.cnt",
pseudo.cnt = 0.5,
p.adj.method="holm",
alpha=0.05)
#creates a formatted dataframe for 16S root samples LinDA
Linda_16S_root_df=
as.data.frame(Linda_16S_root$output$TreeSpeciesPine) %>%
mutate(otu=rownames(.)) %>%
left_join(TaxMat16S_SILVA)
Linda_16S_root_no_random_df=
as.data.frame(Linda_16S_root_no_random$output$TreeSpeciesPine) %>%
mutate(otu=rownames(.)) %>%
left_join(TaxMat16S_SILVA)
#create 16S OTU table just with Soil samples
OtuMat16S_soil=
OtuMat16S_filter %>%
select(contains("Soil"))
#create metadata table just with root samples in 16S otu table
Metadata_16S_soil=
Metadata_16S %>%
filter(SampleID %in% colnames(OtuMat16S_soil))
#runs LinDA test for effect of tree species, using tree individual as random effects
Linda_16S_soil =
linda(
feature.dat=OtuMat16S_soil,
meta.dat=Metadata_16S_soil,
formula='~TreeSpecies + (1|TreeSampleType)',
feature.dat.type="count",
prev.filter=0.1,
zero.handling="pseudo.cnt",
pseudo.cnt = 0.5,
p.adj.method="holm",
alpha=0.05)
Linda_16S_soil_no_random =
linda(
feature.dat=OtuMat16S_soil,
meta.dat=Metadata_16S_soil,
formula='~TreeSpecies',
feature.dat.type="count",
prev.filter=0.1,
zero.handling="pseudo.cnt",
pseudo.cnt = 0.5,
p.adj.method="holm",
alpha=0.05)
#creates a formatted dataframe for 16S root samples LinDA
Linda_16S_soil_df=
as.data.frame(Linda_16S_soil$output$TreeSpeciesPine) %>%
mutate(otu=rownames(.)) %>%
left_join(TaxMat16S_SILVA)
Linda_16S_soil_no_random_df=
as.data.frame(Linda_16S_soil_no_random$output$TreeSpeciesPine) %>%
mutate(otu=rownames(.)) %>%
left_join(TaxMat16S_SILVA)
n_ITS_root=
Linda_ITS_root_df %>%
filter(reject) %>%
nrow
n_ITS_soil=
Linda_ITS_soil_df %>%
filter(reject) %>%
nrow
n_16S_root=
Linda_16S_root_df %>%
filter(reject) %>%
nrow
n_16S_soil=
Linda_16S_soil_df %>%
filter(reject) %>%
nrow
n_ITS_root_no_random=
Linda_ITS_root_no_random_df %>%
filter(reject) %>%
nrow
n_ITS_soil_no_random=
Linda_ITS_soil_no_random_df %>%
filter(reject) %>%
nrow
n_16S_root_no_random=
Linda_16S_root_no_random_df %>%
filter(reject) %>%
nrow
n_16S_soil_no_random=
Linda_16S_soil_no_random_df %>%
filter(reject) %>%
nrow
LINDA_summary=
data.frame(Locus=c("ITS", "ITS", "16S", "16S",
"ITS", "ITS", "16S", "16S"),
SampleType=c("Root","Soil","Root","Soil",
"Root","Soil","Root","Soil"),
ModelType=c("RandomEffect","RandomEffect","RandomEffect","RandomEffect",
"NoRandomEffect","NoRandomEffect","NoRandomEffect","NoRandomEffect"),
n_taxa_significant=c(n_ITS_root, n_ITS_soil, n_16S_root, n_16S_soil,
n_ITS_root_no_random, n_ITS_soil_no_random, n_16S_root_no_random, n_16S_soil_no_random))
LINDA_summary
OTU_ITS_phyloseq=
OtuMatITS %>%
as.matrix %>%
otu_table(taxa_are_rows = TRUE)
TAX_ITS_phyloseq=
TaxMatITS %>%
filter(otu %in% rownames(OtuMatITS)) %>%
column_to_rownames("otu") %>%
as.matrix %>%
tax_table
SAMPLES_ITS_phyloseq=
Metadata_ITS %>%
filter(SampleID %in% colnames(OTU_ITS_phyloseq)) %>%
column_to_rownames("SampleID") %>%
sample_data()
PhyloseqITS <- phyloseq(OTU_ITS_phyloseq, TAX_ITS_phyloseq, SAMPLES_ITS_phyloseq)
PhyloseqITS_root=subset_samples(PhyloseqITS, SampleType=="Root")
ANCOM_ITS_root = ancombc2(data = PhyloseqITS_root, tax_level = NULL,
fix_formula = "TreeSpecies", rand_formula = NULL,
p_adj_method = "fdr", pseudo_sens = TRUE,
prv_cut = 0.10, lib_cut = 1000, s0_perc = 0.05,
group = "TreeSpecies", struc_zero = FALSE, neg_lb = FALSE,
alpha = 0.05, n_cl = 2, verbose = TRUE,
global = TRUE, pairwise = FALSE,
dunnet = FALSE, trend = FALSE,
iter_control = list(tol = 1e-5, max_iter = 20,
verbose = FALSE),
em_control = list(tol = 1e-5, max_iter = 100),
lme_control = NULL,
mdfdr_control = list(fwer_ctrl_method = "fdr", B = 100),
trend_control = NULL)
ANCOM_ITS_root_df=
ANCOM_ITS_root$res %>%
as.data.frame %>%
filter(diff_TreeSpeciesPine) %>%
rename("otu"="taxon") %>%
left_join(TaxMatITS)
ANCOM_ITS_root_no_random=ANCOM_ITS_root
ANCOM_ITS_root_no_random_df=
ANCOM_ITS_root_no_random$res %>%
as.data.frame %>%
filter(diff_TreeSpeciesPine) %>%
rename("otu"="taxon") %>%
left_join(TaxMatITS)
View(ANCOM_ITS_root_no_random_df)
ANCOM_ITS_root = ancombc2(data = PhyloseqITS_root, tax_level = NULL,
fix_formula = "TreeSpecies", rand_formula = "(1|TreeSampleType)",
p_adj_method = "fdr", pseudo_sens = TRUE,
prv_cut = 0.10, lib_cut = 1000, s0_perc = 0.05,
group = "TreeSpecies", struc_zero = FALSE, neg_lb = FALSE,
alpha = 0.05, n_cl = 2, verbose = TRUE,
global = TRUE, pairwise = FALSE,
dunnet = FALSE, trend = FALSE,
iter_control = list(tol = 1e-5, max_iter = 20,
verbose = FALSE),
em_control = list(tol = 1e-5, max_iter = 100),
lme_control = NULL,
mdfdr_control = list(fwer_ctrl_method = "fdr", B = 100),
trend_control = NULL)
