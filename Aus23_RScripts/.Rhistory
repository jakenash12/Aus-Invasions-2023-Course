taxon
ANCOM_ITS_soil$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_soil_sig) %>%
mutate(Enrichment=ifelse(TreeSpeciesPine<0, "Eucalyptus_enriched", "Pine_enriched")) %>%
View
ANCOM_ITS_soil_results=
ANCOM_ITS_soil$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_soil_sig) %>%
mutate(Enrichment=ifelse(TreeSpeciesPine<0, "Eucalyptus_enriched", "Pine_enriched"))
ANCOM_ITS_root_results=
ANCOM_ITS_root$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_root_sig) %>%
mutate(Enrichment=ifelse(TreeSpeciesPine<0, "Eucalyptus_enriched", "Pine_enriched")) %>%
View
ANCOM_ITS_root_results=
ANCOM_ITS_root$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_root_sig) %>%
mutate(Enrichment=ifelse(TreeSpeciesPine<0, "Eucalyptus_enriched", "Pine_enriched"))
View(ANCOM_ITS_root_results)
View(ANCOM_ITS_soil_results)
SuillOTUS=
TaxMatITS %>%
filter(Phylum=="Glomeromycota", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
SuillOTUS=
TaxMatITS %>%
filter(Genus=="Xenopolyscytalum", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
SuillOTUS=
TaxMatITS %>%
filter(Genus=="Penicillium", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
SuillOTUS=
TaxMatITS %>%
filter(Genus=="Genus:Talaromyces", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
SuillOTUS=
TaxMatITS %>%
filter(Genus=="Talaromyces", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
SuillOTUS=
TaxMatITS %>%
filter(Genus=="Oidiodendron", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
SuillOTUS=
TaxMatITS %>%
filter(Genus=="Phialocephala", .$otu %in% colnames(OtuMatITS_rare)) %$%
otu
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
SuillusAbundance=
OtuMatITS_rare %>%
select(SuillOTUS) %>%
mutate(Suillus=rowSums(.)) %>%
select(Suillus) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
ggplot(SuillusAbundance, aes(x=SampleType, y=log(Suillus+1), color=TreeSpecies)) +
geom_boxplot()
knitr::opts_chunk$set(echo = TRUE)
print(ANCOM_ITS_root_results)
p_thresh=0.05
View(ANCOM_ITS_soil_sig)
View(ANCOM_ITS_root_results)
ANCOM_ITS_root_results %>%
arrange(TreeSpeciesPine) %>%
slice(c(1:20, (n() - 19):n())) %>% View
library(tidyverse)
library(vegan)
library(car)
library(magrittr)
library(ecodist)
library(ANCOMBC)
library(phyloseq)
extract_text <- function(x) {
sub(".+__", "", x)
}
TaxMatITS=
read_tsv("../Aus23_ITS_Metabarcoding/ITS2_Dada2_repseqs97_taxonomy.tsv") %>%
rename("otu"="Feature ID") %>%
select(-Confidence) %>%
separate_wider_delim(too_few="align_start", cols = Taxon, delim = ";", names = c("Kingdom", "Phylum","Class", "Order","Family","Genus","Species", "SH")) %>%
mutate(across(!contains("otu"), ~extract_text(.)))
OtuMatITS=
read_tsv("../Aus23_ITS_Metabarcoding/ITS2_OTUTable_97.tsv", skip=1) %>%
column_to_rownames("#OTU ID")
Metadata_ITS=
read_tsv("../Aus23_16S_Metabarcoding/MetabarcodingMetadata.txt") %>%
slice(-1) %>%
rename("SampleID"=`sample-id`)
SeqDepthITS=
OtuMatITS %>%
colSums() %>%
as.data.frame %>%
set_colnames("n_sequences")
RareCurve_ITs=
OtuMatITS %>%
t %>%
rarecurve(step=500, tidy=TRUE)
ggplot(RareCurve_ITs, aes(x=Sample, y=Species, group=Site)) +
geom_line() +
geom_vline(xintercept=70218, linetype=2) +
ylab("# ASVs") +
xlab("# Sequences")
set.seed(2023)
OtuMatITS_rare=
OtuMatITS %>%
t %>%
as.data.frame %>%
rrarefy(sample=70218) %>%
as.data.frame %>%
select(-which(colSums(.) == 0)) %>%
filter(rowSums(.) >= 70218)
ANCOM_ITS_root_results %>%
arrange(TreeSpeciesPine) %>%
slice(c(1:20, (n() - 19):n())) %>%  View
ANCOM_ITS_root_results=
ANCOM_ITS_root$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_root_sig) %>%
rename(TreeSpeciesPine="LFC")
ANCOM_ITS_root_results=
ANCOM_ITS_root$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_root_sig) %>%
rename("LFC"="TreeSpeciesPine")
ANCOM_ITS_root_results=
ANCOM_ITS_root$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_root_sig) %>%
rename("LFC"="TreeSpeciesPine") %>%
mutate(Enrichment=ifelse(LFC<0, "Eucalyptus_enriched", "Pine_enriched"))
View(ANCOM_ITS_root_results)
ANCOM_ITS_root_results %>%
arrange(TreeSpeciesPine) %>%
slice(c(1:20, (n() - 19):n())) %>%
ggplot(aes(x=taxon, y=LFC)) +
geom_bar()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
ggplot(aes(x=taxon, y=LFC)) +
geom_bar()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
ggplot(aes(x=taxon, y=LFC)) +
geom_bar(stat="identity")
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
ggplot(aes(x=taxon, y=LFC)) +
geom_bar(stat="identity") +
coord_flip()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
ggplot(aes(x=taxon, y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=taxon, y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=taxon, y=reorder(taxon, -LFC), fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, -LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_test
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_test()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_classic()
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal()
ANCOM_ITS_soil_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Soils - Eucalyptus vs. Pine")
ANCOM_ITS_soil_results=
ANCOM_ITS_soil$res$lfc %>%
as.data.frame %>%
filter(taxon %in% ANCOM_ITS_soil_sig) %>%
rename("LFC"="TreeSpeciesPine") %>%
mutate(Enrichment=ifelse(LFC<0, "Eucalyptus_enriched", "Pine_enriched"))
ANCOM_ITS_soil_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Soils - Eucalyptus vs. Pine")
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Plant Roots - Eucalyptus vs. Pine")
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Plant Roots - Eucalyptus vs. Pine - Top 40 enriched taxa")
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Plant Roots - Eucalyptus vs. Pine - Top 40 enriched taxa") +
geom_vline(xintercept=0)
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Plant Roots - Eucalyptus vs. Pine - Top 40 enriched taxa") +
geom_hline(yintercept=0)
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Plant Roots - Eucalyptus vs. Pine - Top 40 enriched taxa") +
geom_hline(yintercept=0, size=1)
ANCOM_ITS_root_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Plant Roots - Eucalyptus vs. Pine - Top 40 enriched taxa") +
geom_hline(yintercept=0)
ANCOM_ITS_soil_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Soils - Eucalyptus vs. Pine - Top 40 enriched taxa") +
geom_hline(yintercept=0)
ANCOM_ITS_soil_results %>%
arrange(LFC) %>%
slice(c(1:30, (n() - 39):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Soils - Eucalyptus vs. Pine - Top 40 enriched taxa") +
geom_hline(yintercept=0)
ANCOM_ITS_soil_results %>%
arrange(LFC) %>%
slice(c(1:20, (n() - 19):n())) %>%
arrange(desc(LFC)) %>%
ggplot(aes(x=reorder(taxon, LFC), y=LFC, fill=Enrichment)) +
geom_bar(stat="identity") +
coord_flip() +
theme_minimal() +
ggtitle("Soils - Eucalyptus vs. Pine - Top 40 enriched taxa") +
geom_hline(yintercept=0)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(vegan)
library(magrittr)
library(tibble)
extract_text <- function(x) {
sub(".+__", "", x)
}
TaxMatITS=
read_tsv("../Aus23_ITS_Metabarcoding/ITS2_Dada2_repseqs97_taxonomy.tsv") %>%
rename("otu"="Feature ID") %>%
select(-Confidence) %>%
separate_wider_delim(too_few="align_start", cols = Taxon, delim = ";", names = c("Kingdom", "Phylum","Class", "Order","Family","Genus","Species", "SH")) %>%
mutate(across(!contains("otu"), ~extract_text(.)))
OtuMatITS=
read_tsv("../Aus23_ITS_Metabarcoding/ITS2_OTUTable_97.tsv", skip=1) %>%
column_to_rownames("#OTU ID")
Metadata_ITS=
read_tsv("../Aus23_16S_Metabarcoding/MetabarcodingMetadata.txt") %>%
slice(-1) %>% #remove the comment row
rename("SampleID"=`sample-id`) #rename SampleID column
#calculates sequencing depth by taking column sums of OTU table
SeqDepthITS=
OtuMatITS %>%
colSums() %>%
as.data.frame %>%
set_colnames("n_sequences")
#uses vegan function to generate rarefaction curve dataframe using a step of 500 seqs
RareCurve_ITs=
OtuMatITS %>%
t %>%
rarecurve(step=500, tidy=TRUE)
#sets rarefaction depth to 70,218 seqs, based on seq depth dataframe
rare_depth_ITS=70218
#plots rarefaction curve, drawing a vertical line at the rarefaction depth
ggplot(RareCurve_ITs, aes(x=Sample, y=Species, group=Site)) +
geom_line() +
geom_vline(xintercept=rare_depth_ITS, linetype=2) +
ylab("# ASVs") +
xlab("# Sequences")
set.seed(2023) #make sure to set the random seed so that rarefaction is reproducible
#uses vegan rarefaction function to rarefy to previously defined rarefaction depth
OtuMatITS_rare=
OtuMatITS %>%
t %>%
as.data.frame %>%
rrarefy(sample=rare_depth_ITS) %>%
as.data.frame %>%
select(-which(colSums(.) == 0)) %>%
filter(rowSums(.) >= 70218)
OtuMatITS_rare_pooled=
OtuMatITS_rare %>%
mutate(TreeSampleType = gsub("-.", "", rownames(.))) %>% #make a new column with the tree ID and sample type
group_by(TreeSampleType) %>% #group dataframe by tree ID and sample type
summarise(across(everything(), sum, .names = "{.col}")) %>% #sum together sequence counts for all samples that were from the same tree and sample type
column_to_rownames("TreeSampleType") #set rownames to tree ID_sample type
OtuMatITS_rare_pooled_rel=
OtuMatITS_rare_pooled %>%
mutate(across(everything(), ~ . / rowSums(across(everything()))))
OtuMatITS_rare_rel=
OtuMatITS_rare %>%
mutate(across(everything(), ~ . / rowSums(across(everything()))))
Aitchison_unpooled_ITS=vegdist(OtuMatITS_rare, method = "aitchison", pseudocount=1)
Aitchison_pooled_ITS=vegdist(OtuMatITS_rare_pooled, method = "aitchison", pseudocount=1)
AlphaDiv_ITS=
data.frame(Shannon=diversity(OtuMatITS_rare, index="shannon"),
Simpson=diversity(OtuMatITS_rare, index="simpson"),
Invsimpson=diversity(OtuMatITS_rare, index="invsimpson"),
Richness=specnumber(OtuMatITS_rare)) %>%
mutate(SampleID=rownames(.)) %>%
left_join(Metadata_ITS)
devtools::install_github("ropenscilabs/datastorr")
library(fungaltraits)
devtools::install_github("ropenscilabs/datastorr")
devtools::install_github("traitecoevo/fungaltraits")
library(fungaltraits)
fungal_traits() #download the trait data into R
fungal_traits() #download the trait data into R
fungal_traits() %>% View #download the trait data into R
remotes::install_github("jgmv/misctools")
colnames(TaxMatITS)
TaxMatITS_guild=
fungalTraits_annotation(
TaxMatITS,
print_missing = T,
amf = T,
coltaxa = c("Genus", "Phylum")
)
library(misctools) # used for funguild annotation function: https://rdrr.io/github/jgmv/misctools/
TaxMatITS_guild=
fungalTraits_annotation(
TaxMatITS,
print_missing = T,
amf = T,
coltaxa = c("Genus", "Phylum")
)
typeof(TaxMatITS)
devtools::install_github("brendanf/FUNGuildR")
library(FUNGuildR)
fungal _traits() %>% View
fungal_traits() %>% View
fungal_traits() %>% colnames()
fungal_traits() %$% trophic_mode_fg
fungal_traits() %$% trophic_mode_fg %>% View
fungal_traits() %>% select(genus, trophic_mode_fg) %>% as.data.frame %>%View
fungal_traits() %>% select(Genus, trophic_mode_fg) %>% as.data.frame %>%View
test=fungal_traits()
test$guild_fg %>% View
test %>% select(guild_fg, Genus) %>% View
filepath="../Aus23_R_outputs/ITS/"
ls(filepath)
list.files(filepath)
write.csv(OtuMatITS_rare, paste(filepath, "OtuMatITS_rare.csv", sep=""))
write.csv(OtuMatITS_rare_rel, paste(filepath, "OtuMatITS_rare_rel.csv", sep=""))
write.csv(OtuMatITS_rare_rel, paste(filepath, "OtuMatITS_rare_rel.csv", sep=""))
write.csv(OtuMatITS_rare_pooled, paste(filepath, "OtuMatITS_rare_pooled.csv", sep=""))
write.csv(OtuMatITS_rare_pooled_rel, paste(filepath, "OtuMatITS_rare_pooled_rel.csv", sep=""))
write.csv(OtuMatITS_rare_pooled_rel, paste(filepath, "OtuMatITS_rare_pooled_rel.csv", sep=""))
write.csv(as.matrix(Aitchison_unpooled_ITS), paste(filepath, "Aitchison_unpooled_ITS.csv", sep=""))
write.csv(as.matrix(Aitchison_pooled_ITS), paste(filepath, "Aitchison_pooled_ITS.csv", sep=""))
list.files(filepath)
knitr::opts_chunk$set(echo = TRUE)
write.csv(OtuMatITS_rare, paste(filepath, "OtuMatITS_rare.csv", sep=""))
write.csv(OtuMatITS_rare_rel, paste(filepath, "OtuMatITS_rare_rel.csv", sep=""))
write.csv(OtuMatITS_rare_rel, paste(filepath, "OtuMatITS_rare_rel.csv", sep=""))
write.csv(OtuMatITS_rare_pooled, paste(filepath, "OtuMatITS_rare_pooled.csv", sep=""))
filepath="../Aus23_ITS_Metabarcoding/"
write.csv(OtuMatITS_rare, paste(filepath, "OtuMatITS_rare.csv", sep=""))
write.csv(OtuMatITS_rare_rel, paste(filepath, "OtuMatITS_rare_rel.csv", sep=""))
write.csv(OtuMatITS_rare_pooled, paste(filepath, "OtuMatITS_rare_pooled.csv", sep=""))
write.csv(OtuMatITS_rare_pooled_rel, paste(filepath, "OtuMatITS_rare_pooled_rel.csv", sep=""))
write.csv(as.matrix(Aitchison_unpooled_ITS), paste(filepath, "Aitchison_unpooled_ITS.csv", sep=""))
write.csv(as.matrix(Aitchison_pooled_ITS), paste(filepath, "Aitchison_pooled_ITS.csv", sep=""))
